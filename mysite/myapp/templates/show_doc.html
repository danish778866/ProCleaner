{% extends 'base.html' %}
{% load staticfiles %}
{% block content %}
<div class="container">
  <div class="row">
    <div class="itemhead col-sm-12 text-center">
      <h3>Clean Strings by Merging
        <i class="itemdrop fa fa-question-circle" style="font-size: 24px;" data-toggle="modal" data-target="#myModal"></i>
      </h3>
    </div>
  </div>
  <form action="{% url 'show_doc' %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="row">
      <!--Number of candidate pairs: {{ num_pairs }} <br>
        Please select the correct label out of the candidate pairs: <br>-->
      <div class="col-sm-4">
        <div class="item col-sm-12">
          <table class="table table-dark table-bordered">
            <tbody>
              {% for s in similar_strings_1 %}
                <tr>
                  <td>
                    <label class="control control--checkbox">
                      <input style="display:inline;" type="checkbox" name="clean" value="{{ s }}" />{{ s }}
                      <div class="control__indicator"></div>
                    <label>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="item col-sm-12">
          <table class="table table-dark table-bordered">
            <tbody>
              {% for s in similar_strings_2 %}
                <tr>
                  <td>
                    <label class="control control--checkbox">
                      <input style="display:inline;" type="checkbox" name="clean" value="{{ s }}" />{{ s }}
                      <div class="control__indicator"></div>
                    <label>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="item col-sm-12">
          <table class="table table-dark table-bordered">
            <tbody>
              {% for s in similar_strings_3 %}
                <tr>
                  <td>
                    <label class="control control--checkbox">
                      <input style="display:inline;" type="checkbox" name="clean" value="{{ s }}" />{{ s }}
                      <div class="control__indicator"></div>
                    <label>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 text-center">
        <button type="submit" value="Clean Up" class="btn btn-primary">Clean Up</button>
        <button type="button" value="Merge" id="mergebtn" class="btn btn-info">Merge</button>
        <button type="button" value="Done" id="donebtn" class="btn btn-success">Done</button>
        <input id="mergeval" type="hidden" name="merge" value="" />
      </div>
    </div>
  </form>
</div>
{% endblock %}
{% block script %}
$("#mergebtn").click(function(){
  var current_merge = []
  var retain_val = ""
  $.each($("input[name='clean']:checked"), function() {
    current_string = $(this).val();
    if (retain_val.length < current_string.length) {
      retain_val = current_string;                                                   
    }
    current_merge.push($(this).val());
  });
  $.each($("input[name='clean']:checked"), function() {
    current_val = $(this).val();
    $(this).val("");
    parent = $(this).parent();
    $(this).parent().css("background-color", "#8FBC8F");
    parent_html = $(this).parent().html();
    new_parent_html = parent_html.split(">")[0] + ">" + retain_val;
    console.log("New parent");
    console.log(new_parent_html);
    $(this).parent().html(new_parent_html);
    console.log(parent);
    console.log($(parent).children());
    $(this).val(retain_val);
    $(this).prop("checked", false);
  });
  current_merge_val = $("#mergeval").val();
  append_val = retain_val + "," + current_merge.join(",");
  if (current_merge_val == "") {
    current_merge_val = append_val;                                                
  } else {
    current_merge_val = current_merge_val + "|" + append_val;                                                      
  }
  $("#mergeval").val(current_merge_val);
  console.log(retain_val);
  console.log(current_merge.join(","));
  console.log(current_merge_val);
});
$("#donebtn").click(function(){
  document.location.href = "{% url 'clean_file' %}";
});
{% endblock %}
